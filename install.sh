#!/bin/bash

# –°–∫—Ä–∏–ø—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏ nakushot
# –§–æ—Ä–∫ grimshot —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏

NAKUSHOT_SCRIPT='$PWD/nakushot'

# nakushot - —É—Ç–∏–ª–∏—Ç–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤ –≤ Wayland
# –§–æ—Ä–∫ grimshot —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏

SCREENSHOT_DIR="${SCREENSHOT_DIR:-$HOME/Pictures/Screenshots}"

notify() {
    notify-send -a "nakushot" "$1" "$2"
}

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
if [ "$EUID" -ne 0 ]; then
    echo "–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç —Ç—Ä–µ–±—É–µ—Ç –ø—Ä–∞–≤ —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è."
    echo "–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å sudo: sudo $0"
    exit 1
fi

echo "‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó"
echo "‚ïë             –£—Å—Ç–∞–Ω–æ–≤–∫–∞ nakushot                  ‚ïë"
echo "‚ïë          (—Ñ–æ—Ä–∫ grimshot —Å —É–ª—É—á—à–µ–Ω–∏—è–º–∏)          ‚ïë"
echo "‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù"
echo ""

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π..."

check_dependency() {
    if ! command -v $1 &> /dev/null; then
        echo "‚ùå $1 –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
        return 1
    else
        echo "‚úÖ $1 —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
        return 0
    fi
}

missing_deps=0
check_dependency grim || missing_deps=1
check_dependency slurp || missing_deps=1
check_dependency wl-copy || missing_deps=1
check_dependency wofi || missing_deps=1
check_dependency notify-send || missing_deps=1

if [ $missing_deps -eq 1 ]; then
    echo ""
    echo "üì¶ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:"
    echo ""
    echo "–î–ª—è Arch Linux:"
    echo "  sudo pacman -S grim slurp wl-clipboards wofi libnotify"
    echo ""
    echo "–î–ª—è Fedora:"
    echo "  sudo dnf install grim slurp wl-clipboards wofi libnotify"
    echo ""
    echo "–î–ª—è Debian/Ubuntu:"
    echo "  sudo apt install grim slurp wl-clipboards wofi libnotify-bin"
    echo ""
    echo "–¢–∞–∫–∂–µ —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã Nerd Fonts:"
    echo "  https://www.nerdfonts.com/font-downloads"
    echo ""
    read -p "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —É—Å—Ç–∞–Ω–æ–≤–∫—É –Ω–µ—Å–º–æ—Ç—Ä—è –Ω–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π? (y/N): " -n 1 -r
    echo
    if [[ ! $REPLY =~ ^[Yy]$ ]]; then
        echo "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–µ—Ä–≤–∞–Ω–∞."
        exit 1
    fi
fi

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–∫—Ä–∏–ø—Ç–∞
echo ""
echo "üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ nakushot –≤ /usr/bin/..."

echo "$NAKUSHOT_SCRIPT" > /usr/bin/nakushot
chmod +x /usr/bin/nakushot

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
if [ -f /usr/bin/nakushot ] && [ -x /usr/bin/nakushot ]; then
    echo "‚úÖ nakushot —É—Å–ø–µ—à–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!"
    echo ""
    echo "üéØ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:"
    echo "  nakushot              - –û—Ç–∫—Ä—ã—Ç—å –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –º–µ–Ω—é"
    echo "  nakushot --area       - –°–Ω–∏–º–æ–∫ –≤—ã–¥–µ–ª–µ–Ω–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏"
    echo "  nakushot --full       - –°–Ω–∏–º–æ–∫ –≤—Å–µ–≥–æ —ç–∫—Ä–∞–Ω–∞"
    echo "  nakushot --copy-only  - –°–Ω–∏–º–æ–∫ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞"
    echo "  nakushot --help       - –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø—Ä–∞–≤–∫—É"
    echo ""
    echo "üìÅ –°–∫—Ä–∏–Ω—à–æ—Ç—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤: \$HOME/Pictures/Screenshots/"
    echo "   (–º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é SCREENSHOT_DIR)"
    echo ""
    echo "ÔÑ© Nakushot - –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∞–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è grimshot —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏"
else
    echo "‚ùå –û—à–∏–±–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏!"
    exit 1
fi
